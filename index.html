<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Tracker</title>
    <script>
        function submitForm() {
            document.getElementById("dateForm").submit();
        }
    </script>
    <style>
        .inline {
            display: flex;
            align-items: center; /* Aligns items vertically in the center */
        }
        .inline label {
            margin-right: 10px; /* Space between label and dropdown */
        }
        .top-right {
            position: absolute;
            top: 20px; /* Adjust as needed */
            right: 20px; /* Adjust as needed */
        }
        .summary-table {
            margin-top: 20px; /* Space above summary table */
            float: right; /* Aligns summary table to the right */
            border-collapse: collapse;
            border: solid black;
        }
        .summary-table th,
        .summary-table td {
            border: solid black;
            padding: 8px;
            text-align: left;
        }
        
        .profit {
            background-color: lightgreen; /* Light green for profit */
        }
        
        .loss {
            background-color: lightcoral; /* Light red for loss */
        }
        
    </style>
</head>
<body>
    <h1>Stock Tracker</h1>

    {% if records %}
        <div class="top-right">
            <h2><a href="{{ url_for('index') }}">Back to Home</a></h2>
        </div>
        
        <h2>Stocks on {{ date }}</h2>
        
        <p>Total Count of Stocks: {{ total_count }} | Total Profit/Loss: {{ total_profit_loss|round(2) }}</p> <!-- Display Total Count and Profit/Loss -->
        
        <!-- Stocks Holding Summary Table -->
        <table border="1">
            <tr>
                <th colspan="6" style="text-align: center;">Stocks Holding Summary</th>
            </tr>
            <tr>
                <th>Date</th>
                <th>Trading Symbol</th>
                <th>Total Quantity</th>
                <th>Average Cost Price</th>
                <th>Last Traded Price</th>
                <th>Profit/Loss</th> <!-- New Column -->
            </tr>
            {% for record in records %}
            {% set profit_loss = record[5] %}
            <tr class="{% if profit_loss > 0 %}profit{% elif profit_loss < 0 %}loss{% endif %}">
                <td>{{ record[0] }}</td> <!-- Date -->
                <td>{{ record[1] }}</td> <!-- Trading Symbol -->
                <td>{{ record[2] }}</td> <!-- Total Quantity -->
                <td>{{ record[3] }}</td> <!-- Average Cost Price -->
                <td>{{ record[4] }}</td> <!-- Last Traded Price -->
                <td>{{ profit_loss|round(2) }}</td> <!-- Profit/Loss -->
            </tr>
            {% endfor %}
        </table>

         <!-- Consolidated Performance Table -->
         <table class="summary-table">
             <tr>
                 <th colspan="2" style="text-align: center;">Consolidated Performance</th>
             </tr>
             <tr>
                 <th>Total Profitable Stocks</th>
                 <td>{{ total_profit_count }}</td>
             </tr>
             <tr>
                 <th>Total Losing Stocks</th>
                 <td>{{ total_loss_count }}</td>
             </tr>
             <tr>
                 <th>Total Profit</th>
                 <td>{{ total_profit|round(2) }}</td>
             </tr>
             <tr>
                 <th>Total Loss</th>
                 <td>{{ total_loss|round(2) }}</td>
             </tr>
             <tr>
                 <th>Total Profit/Loss</th>
                 <td>{{ total_profit_loss|round(2) }}</td> <!-- Existing Total Profit/Loss -->
             </tr>
         </table>

     {% elif quantity_changes %}
         <div class="top-right">
             <h2><a href="{{ url_for('index') }}">Back to Home</a></h2>
         </div>

         <h2>Stocks Quantity Changes</h2>

         <!-- Quantity Changes Table -->
         <table border="1">
             <tr>
                 <th colspan="6" style="text-align: center;">Stocks Quantity Changes</th>
             </tr>
             <tr>
                 <th>Previous Date</th>
                 <th>Current Date</th>
                 <th>Trading Symbol</th>
                 <th>Previous Quantity</th>
                 <th>Current Quantity</th>
                 <th>Action</th> <!-- New Column for Action -->
             </tr>
             {% for change in quantity_changes %}
             <tr>
                 <td>{{ change[0] }}</td>  <!-- Previous Date -->
                 <td>{{ change[1] }}</td>  <!-- Current Date -->
                 <td>{{ change[2] }}</td>  <!-- Trading Symbol -->
                 <td>{{ change[3] }}</td>  <!-- Previous Quantity -->
                 <td>{{ change[4] }}</td>  <!-- Current Quantity -->
                 <td>
                     <!-- Form to mark as buy/sell -->
                     <form method="POST" action="{{ url_for('mark_change') }}">
                         <input type="hidden" name="trading_symbol" value="{{ change[2] }}">
                         <input type="hidden" name="previous_date" value="{{ change[0] }}">
                         <input type="hidden" name="current_date" value="{{ change[1] }}">
                         <button type="submit">Mark as Buy/Sell</button>
                     </form>
                 </td>
             </tr>
             {% endfor %}
         </table>

     {% else %}
         <!-- Dropdown for selecting a date next to the label -->
         <div class="inline">
             <label for="date">Select a Date:</label>
             <form id="dateForm" method="POST" action="/">
                 <select name="date" id="date" onchange="submitForm()">
                     <option value="" selected disabled hidden>Date</option> <!-- Default option -->
                     {% for date in dates %}
                         <option value="{{ date[0] }}">{{ date[0] }}</option>
                     {% endfor %}
                 </select>
             </form>
         </div>

         <!-- No Back to Home link here as there's no data yet -->

         <h2><a href="{{ url_for('quantity_changes') }}">Stocks Quantity Changes</a></h2>

     {% endif %}
</body>
</html>

